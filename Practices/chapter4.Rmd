---
title: "Chapter 4. Modeling the Time Course of Continuous Outcomes"
output: rmarkdown::github_document
---

This publishment modified a sample R code that are now being publicly probided on the book website (http://www.intensivelongitudinal.com/). 
I added interpretations for myself (and maybe, for future researchers), and also changed the code for plots (from R basic code to ggplot2)

```{r setup, echo=FALSE}
knitr::opts_knit$set(root.dir = 'C:/Users/hsg_s/OneDrive - 고려대학교/2021-2학기/세미나/실습/ch4R')
```

```{r}
#load the nlme package
library(nlme)

#Read a csv file containing the data
time <- read.csv('time.csv')
summary(time)
table(time$treatment)
```

* time01(0~1 range)
* time(0~15 range)
* treatment: binary (0/1)
* 16 timepoints for each person
* 25 person for treatment, 25 person for control group. 

```{r, results='hide', message=FALSE}
#Panel plots for Control Group & treatment group
library(ggplot2)
library(dplyr)
```
```{r}
#control group
time_ct <- time %>% filter(treatment==0)

ggplot(time_ct, aes(time, intimacy)) +
  geom_line() +
  geom_point() +
  facet_wrap(~id) +
  ggtitle("Panel plot of control group")

#treatment group
time_tr <- time %>% filter(treatment==1)

ggplot(time_tr, aes(time, intimacy)) +
  geom_line() +
  geom_point() +
  facet_wrap(~id) +
  ggtitle("Panel plot of treatment group")

```

Two graphs are showing the panel plots of control & treatment group.
After exploring the panel plots, I directly analyzed using `lme` function. 
I allowed the autocorrelation error, since this data is time-series. (`correlation = corAR1`) 
Also, this model includes the random effect of intercept and slope. (`random=~time | id``)

```{r}
# time 01(0~1 range) / time(0~15 range), no difference on analysis result

lgmodel <- lme(fixed=intimacy ~ time01*treatment, data=time, random=~time01 | id, correlation = corAR1())
print(summary(lgmodel))


lgmodel2 <- lme(fixed=intimacy ~ time*treatment, data=time, random=~time | id, correlation = corAR1())
print(summary(lgmodel2))

```

We can check the fixed & random effect estimates through above results. 
Using the estimated coefficients and standard deviations, we can also compute the confidence interval of each parameter. 


```{r}
#Panel plots for control group with fitted line

time_fit <- cbind(time, fitted(lgmodel))  
colnames(time_fit)[6] <- 'fit'


time_ct_fit <- time_fit %>% filter(treatment==0)
ggplot(time_ct_fit, aes(time, intimacy)) +
  geom_line() +
  geom_point() +
  geom_smooth(aes(time, fit), color='red') +
  facet_wrap(~id) +
  ggtitle('Panel plots for Control Group with fitted line')

#Panel plots for treatment group with fitted line
time_tr_fit <- time_fit %>% filter(treatment==1)
ggplot(time_tr_fit, aes(time, intimacy)) +
  geom_line() +
  geom_point() +
  geom_smooth(aes(time, fit), color='red') +
  facet_wrap(~id) +
  ggtitle('Panel plots for treatment group with fitted line')
```

panel plots for treatment & control group with the fitted lines. 

